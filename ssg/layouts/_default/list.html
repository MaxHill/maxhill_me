{{ define "head" }}
{{ end }}

{{ define "main" }}
<div class="document-listing-page">
	<nav class="anchor-menu exposed-grid">
		<a href="#hero" class="nav-link small">~</a>
		{{ range sort (.Resources.Match "*.md") "Name"  }}
		<a href="#{{.Params.id}}" class="nav-link">{{.Name}}</a>
		{{end}}
	</nav>
	<div class="main">
		<div id="hero" class="hero glitch-parent">
			<h1 class="h1 text-glitch" title="{{ .Title }}">{{ .Title }}</h1>
		</div>

		{{ range sort (.Resources.Match "*.md") "Name"  }}
		<div id="{{.Params.id}}" class="document">
			<div class="content-grid">
				<ul class="full-width document-metadata">
					<li><span class="label">Title:</span>
					{{ .Title }}</li>
					<li><span class="label">Author:</span>
					{{ .Params.author }}</li>
					<li><span class="label">Date:</span>
					{{ .Date.Format "January 02, 2006" }}</li>
					<li><span class="label">File:</span>
					/content/design-system/{{ .Name }}</li>
					<li>
						<span class="label">Tags:</span>
						{{ range $i, $tag := .Params.tags }}
						{{ $tag }}{{ if not (eq $i (sub (len $.Params.tags) 1)) }},{{ end }}
						{{ end }}
					</li>
				</ul>
				<h2 class="h2">{{ .Title }}</h2>
				{{ .Content }}
			</div>
		</div>
		{{ end }}
	</div>

	<script>
		const parent = document.querySelector('.main');
		const children = document.querySelectorAll('.document, .hero');
		const navLinks = document.querySelectorAll('.nav-link');
		
		navLinks.forEach(link => {
			link.addEventListener('click', (e) => {
				e.preventDefault();
				const targetId = link.getAttribute('href').substring(1);
				const targetElement = document.getElementById(targetId);
				
				targetElement.scrollIntoView({
					behavior: 'smooth',
					inline: 'start',
					block: 'nearest'
					});
					});
					});
					
					// Intersection Observer to detect active section
					const observerOptions = {
						root: parent,
						rootMargin: '0px',
						threshold: 0.5 // Element is considered active when 50% visible
						};
						
						const observer = new IntersectionObserver((entries) => {
							entries.forEach(entry => {
								if (entry.isIntersecting && entry.intersectionRatio >= 0.5) {
									// Remove active class from all
									children.forEach(child => child.classList.remove('active'));
									navLinks.forEach(link => link.classList.remove('active'));
									
									// Add active class to current
									entry.target.classList.add('active');
									const targetId = entry.target.id;
									const correspondingLink = document.querySelector(`a[href="#${targetId}"]`);
									if (correspondingLink) {
										correspondingLink.classList.add('active');
									}
								}
								});
								}, observerOptions);
								
								// Observe all children
								children.forEach(child => observer.observe(child));
	</script>
</div>
{{ end }}

{{ define "script" }}
{{ end }}
