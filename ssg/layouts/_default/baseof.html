<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1">
		<title>{{ .Site.Title }}</title>

		<link rel="preload" href="/fonts/optimized/IBMPlexMono-Regular.woff2" as="font" type="font/woff2" crossorigin>
		<link rel="preload" href="/fonts/optimized/DepartureMono-Regular.woff2" as="font" type="font/woff2" crossorigin>

		{{ $css := resources.Get "css/style.css" | postCSS | minify | fingerprint }}
		<link rel="stylesheet" href="{{ $css.Permalink }}">

		<script>
			(function() {
				const theme = localStorage.getItem('theme');
				if (theme) {
					document.documentElement.setAttribute('data-theme', theme);
					} else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
						document.documentElement.setAttribute('data-theme', 'dark');
						} else {
							document.documentElement.setAttribute('data-theme', 'light');
						}
						})();
		</script>

		{{ block "head" . }}{{ end }}
	</head>
	<body>
		<nav class="main-menu">
			<h1 class="site-title">{{ .Site.Title }}</h1>
            <div>
                <a href="/">Home</a>
                <a href="/design-system">Design system</a>
            </div>

			<form class="theme-switcher">
                <label class="radio-input">
                    <input type="radio" name="theme" value="system">
                    System
                </label>
                <label class="radio-input">
                    <input type="radio" name="theme" value="light">
                    Light
                </label>
                <label class="radio-input">
                    <input type="radio" name="theme" value="dark">
                    Dark
                </label>
			</form>
		</nav>
		{{ block "main" . }}{{ end }}

		<script>
			const form = document.querySelector('.theme-switcher');
			const html = document.documentElement;
			
			// Set initial radio state
			const savedTheme = localStorage.getItem('theme') || 'system';
			document.querySelector(`input[value="${savedTheme}"]`).checked = true;
			
			// Function to update theme with view transition
			function updateTheme(theme) {
				if (theme === 'system') {
					localStorage.removeItem('theme');
					// Apply system preference
					if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
						html.setAttribute('data-theme', 'dark');
						} else {
							html.setAttribute('data-theme', 'light');
						}
						} else {
							localStorage.setItem('theme', theme);
							html.setAttribute('data-theme', theme);
						}
					}
					
					// Handle theme changes with view transition
					form.addEventListener('change', (e) => {
						if (e.target.name === 'theme') {
							const theme = e.target.value;
							
							// Check if View Transitions API is supported
							if (document.startViewTransition) {
								document.startViewTransition(() => updateTheme(theme));
							} else {
								updateTheme(theme);
							}
						}
					});
		</script>
		{{ block "scripts" . }}{{ end }}
	</body>
</html>
