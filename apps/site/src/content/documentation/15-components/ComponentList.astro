---
import customElements from "@maxhill/components/custom-elements.json";
import { marked } from "marked";

const components = customElements.modules
    .flatMap((module) => (module as any).declarations || [])
    .filter(
        (decl) => "customElement" in decl && decl.customElement === true,
    ) as any[];
---

<m-search-list>
    <label slot="controller">Search components</label>
    <input slot="controller" type="search"/>
{
    components.map((component) => (
        <details class="content-grid" data-keywords={component.tagName || component.name}>
            <summary>&lt;{component.tagName || component.name}&gt;</summary>
            <div class="content-grid typesetting" >
            {component.description && (
                <div class="typesetting" set:html={marked.parse(component.description)} />
            )}

            {component.attributes && component.attributes.length > 0 && (
                    <h4>Attributes</h4>
                    <dl>
                        {component.attributes.map((attr: any) => (
                            <>
                                <dt>
                                    <m-copy-button value={attr.name}>
                                        {attr.name}
                                    </m-copy-button>
                                    {attr.type && (
                                        <span class="type">
                                            : {attr.type.text}
                                        </span>
                                    )}
                                </dt>
                                {attr.description && (
                                    <dd>{attr.description}</dd>
                                )}
                            </>
                        ))}
                    </dl>
            )}

            {component.slots && component.slots.length > 0 && (
                    <h4>Slots</h4>
                    <dl>
                        {component.slots.map((slot: any) => (
                            <>
                                <dt>
                                    <m-copy-button value={`slot="${slot.name || ''}"`}>
                                        slot="{slot.name || '(default)'}"
                                    </m-copy-button>
                                </dt>
                                {slot.description && (
                                    <dd>{slot.description}</dd>
                                )}
                            </>
                        ))}
                    </dl>
            )}

            {component.cssParts && component.cssParts.length > 0 && (
                    <h4>CSS Parts</h4>
                    <dl>
                        {component.cssParts.map((part: any) => (
                            <>
                                <dt>
                                    <m-copy-button value={`::part(${part.name})`}>
                                        ::part({part.name})
                                    </m-copy-button>
                                </dt>
                                {part.description && (
                                    <dd>{part.description}</dd>
                                )}
                            </>
                        ))}
                    </dl>
            )}

            {component.members && component.members.filter((m: any) => !m.static && m.privacy !== 'private').length > 0 && (
                    <h4>Public Members</h4>
                    <dl>
                        {component.members.filter((m: any) => !m.static && m.privacy !== 'private').map((member: any) => (
                            <>
                                <dt>
                                    <m-copy-button value={member.name}>
                                        {member.name}
                                    </m-copy-button>
                                    {member.type && (
                                        <span class="type">
                                            : {member.type.text}
                                        </span>
                                    )}
                                </dt>
                                {member.description && (
                                    <dd>{member.description}</dd>
                                )}
                            </>
                        ))}
                    </dl>
            )}

            {component.events && component.events.length > 0 && (
                    <h4>Events</h4>
                    <dl>
                        {component.events.map((event: any) => (
                            <>
                                <dt>
                                    <m-copy-button value={event.name}>
                                        {event.name}
                                    </m-copy-button>
                                    {event.type && (
                                        <span class="type">{event.type.text}</span>
                                    )}
                                </dt>
                                {event.description && (
                                    <dd>{event.description}</dd>
                                )}
                            </>
                        ))}
                    </dl>
            )}
            </div>
        </details>
    ))
}
</m-search-list>

<style>
    details {
        display: content;

        &[data-match="false"] {
            display: none;
        }
    }

    dl {
        display: grid;
        grid-template-columns: auto auto 1fr;
        gap: var(--size-fluid-1);

        dt {
            display: grid;
            grid-column: span 2;
            grid-template-columns: subgrid;
            m-copy-button {
                font-size: var(--font-size-1);
            }
        }
        dd {}
    }

</style>
