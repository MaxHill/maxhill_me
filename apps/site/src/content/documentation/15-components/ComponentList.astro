---
import customElements from "@maxhill/components/custom-elements.json";
import { marked } from "marked";
import { getAllComponents, getComponentPublicProperties, getComponentPublicMethods, getComponentEventsWithType, getCustomEventDetailTypes } from "@wc-toolkit/cem-utilities";

const components = getAllComponents(customElements).map((component) => {
    const properties = getComponentPublicProperties(component);
    const methods = getComponentPublicMethods(component);
    const events = getComponentEventsWithType(component, { overrideCustomEventType: true });
    const customEventDetailTypes = getCustomEventDetailTypes(component);
    const publicMembers = component.members?.filter((m: any) => !m.static && m.privacy !== 'private') || [];
    
    return {
        ...component,
        properties,
        methods,
        events,
        customEventDetailTypes,
        publicMembers,
    };
});
---

<m-search-list>
    <label slot="controller">Search components</label>
    <input slot="controller" type="search"/>
{
    components.map((component) => (
        <details class="content-grid" data-keywords={component.tagName || component.name}>
            <summary>&lt;{component.tagName || component.name}&gt;</summary>
            <div class="content-grid typesetting" >
            {component.description && (
                <div class="typesetting" set:html={marked.parse(component.description)} />
            )}

            {component.properties && component.properties.length > 0 && (
                    <>
                        <h4>Properties</h4>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th class="name">Name</th>
                                        <th class="type">Type</th>
                                        <th class="description">Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {component.properties.map((prop: any) => (
                                        <tr>
                                            <td class="name">
                                                <m-copy-button value={prop.name}>
                                                    {prop.name}
                                                </m-copy-button>
                                            </td>
                                            <td class="type">{prop.type?.text}</td>
                                            <td class="description">{prop.description}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </>
            )}

            {component.methods && component.methods.length > 0 && (
                    <>
                        <h4>Methods</h4>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th class="name">Name</th>
                                        <th class="type">Type</th>
                                        <th class="description">Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {component.methods.map((method: any) => (
                                        <tr>
                                            <td class="name">
                                                <m-copy-button value={method.name}>
                                                    {method.name}
                                                </m-copy-button>
                                            </td>
                                            <td class="type">{method.type?.text}</td>
                                            <td class="description">{method.description}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </>
            )}

            {component.events && component.events.length > 0 && (
                    <>
                        <h4>Events</h4>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th class="name">Name</th>
                                        <th class="type">Type</th>
                                        <th class="description">Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {component.events.map((event: any) => (
                                        <tr>
                                            <td class="name">
                                                <m-copy-button value={event.name}>
                                                    {event.name}
                                                </m-copy-button>
                                            </td>
                                            <td class="type">{event.type?.text}</td>
                                            <td class="description">{event.description}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </>
            )}

            {component.slots && component.slots.length > 0 && (
                    <>
                        <h4>Slots</h4>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th class="name">Name</th>
                                        <th class="description">Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {component.slots.map((slot: any) => (
                                        <tr>
                                            <td class="name">
                                                <m-copy-button value={`slot="${slot.name || ''}"`}>
                                                    slot="{slot.name || '(default)'}"
                                                </m-copy-button>
                                            </td>
                                            <td class="description">{slot.description}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </>
            )}

            {component.cssParts && component.cssParts.length > 0 && (
                    <>
                        <h4>CSS Parts</h4>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {component.cssParts.map((part: any) => (
                                        <tr>
                                            <td>
                                                <m-copy-button value={`::part(${part.name})`}>
                                                    ::part({part.name})
                                                </m-copy-button>
                                            </td>
                                            <td>{part.description}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </>
            )}
            </div>
        </details>
    ))
}
</m-search-list>

<style>
    :global([data-match="false"]) {
        display: none;
    }

    details {
        display: content;

        &[data-match="false"] {
            display: none;
        }
    }

    .table-wrapper {
        overflow-x: auto;
        width: 100%;
    }

    table {
        width: max-content;
        border-collapse: collapse;
        
        th, td {
            text-align: left;
            padding: var(--size-2);
        }

        th {
            font-weight: 600;
            white-space: nowrap;
        }

        tr {
            border-bottom: var(--border);
        }

        th:nth-child(1), td:nth-child(1),
        th:nth-child(2), td:nth-child(2) {
            width: max-content;
            white-space: nowrap;
        }

        th:nth-child(3), td:nth-child(3) {
            width: max-content;
            max-width: var(--size-content-1);
        }

        td {
            m-copy-button {
                font-size: var(--font-size-1);
            }
        }
    }

</style>
