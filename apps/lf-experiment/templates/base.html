<!DOCTYPE html>
<html lang="en" data-theme="light">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>lf-experiment</title>

		<link rel="stylesheet" href="/css/style.css">
	</head>
	<body>
		<main>
			{{template "content" .}}
		</main>

		<script type="module" src="/js/main.js"></script>

		<script>
			if ('serviceWorker' in navigator) {
				window.addEventListener('load', () => {
					navigator.serviceWorker.register('/serviceworker.js')
					.then(registration => {
						console.log('Service Worker registered:', registration.scope);
						})
						.catch(error => {
							console.error('Service Worker registration failed:', error);
							});
							});
							
							{{if not .IsDev}}
							let refreshing = false;
							navigator.serviceWorker.addEventListener('controllerchange', () => {
								if (!refreshing) {
									refreshing = true;
									console.log('Service Worker updated, reloading page...');
									window.location.reload();
								}
								});
								{{end}}
							}
		</script>

		<!-- Live Reload (Dev Mode Only) -->
		{{if .IsDev}}
		<script>
			document.addEventListener('DOMContentLoaded', () => {
				const eventSource = new EventSource('/dev/reload-stream');
				
				eventSource.addEventListener('reload', (event) => {
					console.log('Dev server: Reloading...');
					window.location.reload();
					});
					
					eventSource.addEventListener('open', () => {
						console.log('Dev server: Live reload connected');
						});
						
						eventSource.addEventListener('error', (e) => {
							// EventSource automatically reconnects, only log if connection is closed
							if (eventSource.readyState === EventSource.CLOSED) {
								console.log('Dev server: Connection closed');
							}
							});
							})
		</script>
		{{end}}
	</body>
</html>
